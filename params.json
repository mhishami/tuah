{"name":"Tuah","tagline":"A Simple Cowboy Frontend, inspired by BeepBeep","body":"![logo](https://raw.githubusercontent.com/mhishami/tuah/master/example/foo/priv/static/img/tuah-small.png)\r\n\r\n> Tuah\r\n> ====\r\n> Tuah is a simple, HTTP framework, inspired by BeepBeep with Cowboy as the underlying mechanism.\r\n> \r\n> Easy to extend, comes with session management and continous code compilations to make it a very productive framework to begin with.\r\n> \r\n> Built on the strength of Cowboy and MongoDB, development time is greatly reduced.\r\n\r\nQuick Start\r\n-----------\r\n\r\n1. Create A New Project\r\n\r\n  Creating a new project is made simpler via the addition of `new_app.sh` script.\r\n\r\n  ``` shell\r\n  hisham@skrall:tuah$ ./new_app.sh foo\r\n  Creating new app: foo\r\n  Creating directory...\r\n  Creating template files...\r\n  Creating bootstrap files...\r\n  Finishing up...\r\n  Done. Your app is created in ../foo.\r\n  +----------------------+\r\n  |     Happy coding!    |\r\n  +----------------------+\r\n  hisham@skrall:tuah$ \r\n\r\n  ```\r\n  \r\n2. The project structure looks like\r\n\r\n  ``` shell\r\n  foo\r\n  ├── Makefile\r\n  ├── erlang.mk\r\n  ├── include\r\n  │   └── foo.hrl\r\n  ├── priv\r\n  │   └── static\r\n  │       ├── assets/\r\n  │       ├── css/\r\n  │       ├── dist/  \r\n  │       └── img\r\n  │           ├── tuah-small.png\r\n  │           └── tuah.png\r\n  ├── rel\r\n  │   ├── sys.config\r\n  │   └── vm.args\r\n  ├── relx\r\n  ├── relx.config\r\n  ├── run.sh\r\n  ├── src\r\n  │   ├── auth_controller.erl\r\n  │   ├── baz.app.src\r\n  │   ├── baz_app.erl\r\n  │   ├── baz_sup.erl\r\n  │   ├── home_controller.erl\r\n  │   └── secret_controller.erl\r\n  └── templates\r\n      ├── error.dtl\r\n      ├── home.dtl\r\n      ├── login.dtl\r\n      ├── public.dtl\r\n      └── register.dtl\r\n\r\n  ```\r\n3. Start the mongodb server, as the sample application does live registration and all.\r\n\r\n4. Run The App\r\n> The App\r\n> ====\r\n> \r\n> This simple app does user registration, login and logout.\r\n> Extend this further to your likings.\r\n\r\n  ``` shell\r\n  $ make\r\n  $ ./run.sh console\r\n\r\n  ```\r\n  View the app at http://localhost:8080  \r\n  That's it!\r\n\r\n5. Extend the app the way you like it by adding more templates, controllers to make a full blown app.\r\n\r\n6. Feel free to fork this. Cheers!\r\n\r\nMongo Backend\r\n-------------\r\n1. Tuah framework comes with mongo client integration. Almost *all* the APIs are supported. Feel free to browse the source code.\r\n\r\n2. Advanced examples such as regex search, complex find and match are supported. Details query and projection operators can be found at [https://docs.mongodb.org/manual/reference/operator/](MongoDB Reference)\r\n\r\n3. Different notations for Selector/Projector, use which one that you like. I preferred the second notation as it is easier to read and comprehend.\r\n\r\n  ```\r\n  mongo_worker:find(<<\"posts\">>, {<<\"tag\">>, <<\"general\">>, \r\n                                  <<\"cat\">>, <<\"News\">>}, \r\n    [{batchsize, 10}, {skip, 20}, \r\n    {projector, {<<\"created_at\">>, 1, <<\"grpid\">>, 1}}]).\r\n  ```\r\n  ``` \r\n  mongo_worker:find(<<\"posts\">>, #{<<\"tag\">> => <<\"general\">>, \r\n                                   <<\"cat\">> => <<\"News\">>}, \r\n    [{batchsize, 10}, {skip, 20}, \r\n    {projector, #{<<\"created_at\">> => 1, <<\"grpid\">> => 1}}]).\r\n  ```\r\n\r\n4. Regular expressions are also there.\r\n\r\n  ```\r\n  mongo_worker:find(<<\"posts\">>, \r\n    {<<\"title\">>, #{<<\"$regex\">>  => <<\"some*\">>, \r\n                    <<\"$options\">> => <<\"i\">>}}, \r\n    [{projector, #{<<\"grpid\">> => 1, \r\n                   <<\"title\">> => 1, \r\n                   <<\"author.fullname\">> => 1}}]).\r\n  ```\r\nRouting\r\n-------\r\n1. Routing is made simple in tuah, where the URL is broken up into multiple items, to be handled by the request handlers.\r\n\r\n2. Below is the breakdown of the request URL, and the components it is broken up into:\r\n \r\n  - `/post/message/20`\r\n    - **Controller**: `post_controller.erl`\r\n    - **Action**: `<<\"message\">>`\r\n    - **Args**: `[ 20 ]`\r\n  - `/user/view/details/100`\r\n    - **Controller**: `user_controller.erl`\r\n    - **Action**: `<<\"view\">>`\r\n    - **Args**: `[<<\"details\">>, 100]`\r\n  - `/view/message/20?float=false&data=none`\r\n    - **Controller**: `view_controller.erl`\r\n    - **Action**: `<<\"message\">>`\r\n    - **Args**: `[ 20 ]`\r\n    - **Params**: `#{qs_vals => [{<<\"float\">>, <<\"false\">>},\r\n     {<<\"data\">>, <<\"none\">>}],...}`\r\n\r\nControllers\r\n-----------\r\n1. All controllers can be defined by using the `tuah_controller` behavior.\r\n\r\n2. All handlers are in the form:\r\n\r\n  ```\r\n  handle_request(Method, Action, Args, Params, Req)\r\n  ```\r\n\r\n3. Request handler parameters:\r\n  - `Method` - can be HTTP Method, capitalized (e.g. GET, POST, PUT, DELETE etc.)\r\n  - `Action` - the second parameters in the URL chosen, e.g.\r\n    - `/user/delete` : Action = `delete`\r\n    - `/post/view` : Action = `view`\r\n  - `Args` - the list of arguments of the URL\r\n    - `/user/delete/20/` : Args = `[20]`\r\n    - `/post/view/977/simple` : Args = `[ 997, <<\"simple\">>]`\r\n  - `Params` - the request parameters\r\n    - `qs_vals` : contains the `GET` query string variables\r\n    - `qs_body` : contains the `POST` query string variables\r\n    - `files` : contains the file uploads data\r\n    - `auth` : contains the authentication context\r\n    - `sid` : contains the session id\r\n  - `Req` - the Cowboy Req parameters. It is hardly used, but just in case you want to play around with the Cowboy internals.\r\n  \r\n\r\nSession Context\r\n--------------\r\n1. Session context is carried in the `Params` in each request:\r\n  - `sid` - The session id \r\n  - `auth` - The authentication context\r\n\r\n2. Authentication context is to be used sparingly. **DO NOT** carry sensitive information in the `auth` context. Only username/email address is suffice.\r\n\r\nAuthentication\r\n--------------\r\n1. Authentication is done using the session context `auth` and `sid` in the `Params` of request handler.\r\n\r\n2. Typical authentication procedures are:\r\n\r\n  ```\r\n  handle_request(<<\"POST\">>, <<\"login\">> = Action, _Args, Params, _Req) ->    \r\n      PostVals = maps:get(<<\"qs_body\">>, Params),\r\n      Username = proplists:get_value(<<\"username\">>, PostVals),\r\n      Password = proplists:get_value(<<\"password\">>, PostVals),\r\n  \r\n      case Username =:= <<>> orelse Password =:= <<>> of\r\n          true ->\r\n              {render, Action, [{error, <<\"All fields are required.\">>}]};\r\n          _ ->\r\n              case mongo_worker:find(?DB_USERS, #{<<\"username\">> => Username}) of\r\n                  {ok, []} ->\r\n                      {render, Action, [{error, <<\"Invalid username, or password\">>}]};\r\n                  {ok, [User]} ->\r\n                      ?DEBUG(\"User= ~p~n\", [User]),\r\n                      HashPass = web_util:hash_password(Password),\r\n                      Pass = maps:get(<<\"password\">>, User),\r\n                      case Pass =/= HashPass of\r\n                          true ->\r\n                              {render, Action, [{error, <<\"Invalid username, or password\">>}]};\r\n                          _ ->\r\n                              Sid = maps:get(<<\"sid\">>, Params),\r\n                              session_worker:set_cookies(Sid, Username),\r\n  \r\n                              %% redirect, assuming \"secret\" is defined.\r\n                              {redirect, <<\"/secret\">>, {cookie, <<\"auth\">>, Username}}\r\n                      end\r\n              end\r\n      end;\r\n  ```\r\n\r\n3. Logging out can be done by resetting the data in the session\r\n\r\n  ```\r\n  handle_request(<<\"GET\">>, <<\"logout\">>, _Args, Params, _Req) ->\r\n        session_worker:del_cookies(maps:get(<<\"sid\">>, Params)),\r\n        {redirect, <<\"/\">>};\r\n  ```\r\n\r\nTemplates\r\n---------\r\n1. Templates are defined using `erlydtl`, which is a fork of Django Templates.\r\n\r\n2. In each project, you should have a custom `error` template so that all errors can be shown nicely, and react accordingly.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}